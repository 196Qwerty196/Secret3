(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();function U(e,t,o){const r=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__image"),i=r.querySelector(".card__title"),S=r.querySelector(".card__like-button"),I=r.querySelector(".card__control-button_type_delete"),V=r.querySelector(".card__like-count");return c.src=e.link,c.alt=e.name,i.textContent=e.name,V.textContent=e.likes.length,e.likes.some(L=>L._id===o)&&S.classList.add("card__like-button_is-active"),e.owner._id!==o?I.remove():I.addEventListener("click",()=>t.onDeleteCard(r)),c.addEventListener("click",()=>t.onPreviewPicture(e)),S.addEventListener("click",()=>{const L=S.classList.contains("card__like-button_is-active");t.onLikeIcon(r,L),S.classList.toggle("card__like-button_is-active")}),r}function T(e,t,o){const n=e.querySelector(".card__like-count");n.textContent=t}function F(e){e.remove()}const N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},K=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})};function Z(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);r&&(t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass))}function O(e,t){const o=e.form.querySelector(`#${e.id}-error`);o&&(e.classList.remove(t.inputErrorClass),o.textContent="",o.classList.remove(t.errorClass))}function G(e,t,o){let n="";t.validity.valid?(t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name")||t.classList.contains("popup__input_type_avatar"))&&!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(t.value.trim())&&(n=t.dataset.errorMessage):n=t.validationMessage,n?Z(e,t,n,o):O(t,o)}function Q(e){return Array.from(e).some(t=>!t.validity.valid)}function W(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function X(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function x(e,t,o){Q(e)?W(t,o):X(t,o)}function Y(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);x(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{G(e,r,t),x(o,n,t)})})}function b(e,t){const o=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{O(r,t)}),W(n,t)}function ee(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),Y(o,e)})}const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"54250382-5d03-4dfe-9824-e8eb733d19b4","Content-Type":"application/json"}},a=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),te=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(a),H=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(a),oe=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(a),re=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(a),ne=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(a),ce=e=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:s.headers}).then(a),se=e=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:s.headers}).then(a),j=(e,t)=>t?se(e):ce(e),l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ee(l);const z=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),h=g.querySelector(".popup__form"),D=h.querySelector(".popup__input_type_name"),J=h.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),p=q.querySelector(".popup__form"),ie=p.querySelector(".popup__input_type_card-name"),ae=p.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),A=C.querySelector(".popup__image"),le=C.querySelector(".popup__caption"),ue=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),f=B.querySelector(".popup__form"),de=f.querySelector(".popup__input");let m=null;const M=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),R=({name:e,link:t})=>{A.src=t,A.alt=e,le.textContent=e,y(C)},d=(e,t,o,n)=>{e.textContent=t?n:o},_e=e=>{e.preventDefault();const t=h.querySelector(l.submitButtonSelector);d(t,!0,"Сохранить","Сохранение..."),oe({name:D.value,about:J.value}).then(o=>{k.textContent=o.name,w.textContent=o.about,u(g)}).catch(o=>{console.log("Ошибка редактирования профиля:",o)}).finally(()=>{d(t,!1,"Сохранить","Сохранение...")})},me=e=>{e.preventDefault();const t=f.querySelector(l.submitButtonSelector);d(t,!0,"Сохранить","Сохранение..."),re(de.value).then(o=>{E.style.backgroundImage=`url(${o.avatar})`,u(B)}).catch(o=>{console.log("Ошибка обновления аватара:",o)}).finally(()=>{d(t,!1,"Сохранить","Сохранение...")})},fe=e=>{e.preventDefault();const t=p.querySelector(l.submitButtonSelector);d(t,!0,"Создать","Создание..."),ne({name:ie.value,link:ae.value}).then(o=>{z.prepend(U(o,{onPreviewPicture:R,onLikeIcon:(n,r)=>{j(o._id,r).then(c=>{T(n,c.likes.length,c.owner._id===m)}).catch(c=>console.log("Ошибка лайка:",c))},onDeleteCard:()=>{F(o._id).then(()=>{cardElement.remove()}).catch(n=>console.log("Ошибка удаления:",n))}},m)),u(q)}).catch(o=>{console.log("Ошибка добавления карточки:",o)}).finally(()=>{d(t,!1,"Создать","Создание...")})};h.addEventListener("submit",_e);p.addEventListener("submit",fe);f.addEventListener("submit",me);ue.addEventListener("click",()=>{D.value=k.textContent,J.value=w.textContent,b(h,l),y(g)});E.addEventListener("click",()=>{f.reset(),b(f,l),y(B)});pe.addEventListener("click",()=>{p.reset(),b(p,l),y(q)});Promise.all([te(),H()]).then(([e,t])=>{k.textContent=e.name,w.textContent=e.about,E.style.backgroundImage=`url(${e.avatar})`,m=e._id,t.forEach(o=>{const n=U(o,{onPreviewPicture:R,onLikeIcon:(r,c)=>{j(o._id,c).then(i=>{T(r,i.likes.length,i.owner._id===m)}).catch(i=>console.log("Ошибка лайка:",i))},onDeleteCard:r=>{F(o._id).then(()=>r.remove()).catch(c=>console.log("Ошибка удаления:",c))}},m);z.append(n)})}).catch(e=>{console.log("Ошибка загрузки данных:",e)});const ye=document.querySelectorAll(".popup");ye.forEach(e=>{K(e)});const P=document.querySelector(".popup_type_info"),_=P.querySelector(".popup__info"),$=P.querySelector(".popup__list"),he=document.querySelector(".header__logo"),v=(e,t)=>{const n=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},Se=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0),n=document.createElement("img");return n.src=e.avatar,n.alt=e.name,n.style.width="30px",n.style.height="30px",n.style.borderRadius="50%",o.prepend(n),o.append(e.name),o},ve=()=>{H().then(e=>{_.innerHTML="",$.innerHTML="";const t=e.sort((c,i)=>new Date(i.createdAt)-new Date(c.createdAt)),o=t[t.length-1],n=t[0];_.append(v("Общее число карточек:",e.length)),_.append(v("Первая создана:",M(new Date(o.createdAt)))),_.append(v("Последняя создана:",M(new Date(n.createdAt))));const r=new Map;e.forEach(c=>{r.has(c.owner._id)||r.set(c.owner._id,c.owner)}),_.append(v("Участников:",r.size)),r.forEach(c=>{$.append(Se(c))}),y(P)}).catch(e=>console.log("Ошибка загрузки статистики:",e))};he.addEventListener("click",ve);
